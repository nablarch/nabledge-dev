# ToBe: AIエージェント活用Nablarch開発プロセスフロー

**重要**: 設計書は全て**YAML形式**で管理（AI可読化）

**作成日**: 2026-02-16
**関連**: [AsIs開発プロセス](./asis-dev-flow.md)

---

## プロセスフロー図

```mermaid
flowchart TB
    %% 要件定義工程
    subgraph phase1["要件定義工程"]
        subgraph req["要件定義者<br/>(人間主導+AI技術実現性チェック)"]
            A1[要件定義<br/>+AI技術実現性チェック]
        end
        subgraph arch1["アーキテクト<br/>(人間主導+AIパターン提案)"]
            A2[非機能要件定義<br/>方式設計<br/>+AIパターン提案]
        end
    end

    %% 設計工程
    subgraph phase2["設計工程"]
        subgraph arch2["アーキテクト<br/>(AI生成+人間承認)"]
            B1[基盤コンポーネント設計<br/>AI生成]
            B2[開発標準の策定<br/>AI生成]
            B3[パターン検証<br/>AI自動検証]
            B4[サンプル実装]
        end
        subgraph data1["データアナリスト<br/>(人間主導+AI整合性チェック)"]
            C1[ドメイン定義設計<br/>+AI整合性チェック]
            C2[DB設計-論理<br/>+AI整合性チェック]
            C3[DB設計-物理<br/>+AI整合性チェック]
            C4[データパターン洗い出し]
        end
        subgraph designer1["要件定義者・設計者<br/>(人間がYAML作成)"]
            D1[画面設計<br/>YAML形式]
            D2[バッチ設計<br/>YAML形式]
            D3[Webサービス設計<br/>YAML形式]
            D4[共通コンポーネント設計<br/>YAML形式]
            D5[外部IF設計<br/>YAML形式]
        end
    end

    %% PG・UT工程
    subgraph phase3["PG・UT工程"]
        subgraph arch3["アーキテクト<br/>(AI生成+人間承認)"]
            E1[基盤コンポーネント実装<br/>AI生成]
            E2[チェック<br/>AI一次チェック]
        end
        subgraph infra1["インフラ<br/>(AI自動化+人間確認)"]
            E3[環境構築<br/>AI自動化]
        end
        subgraph appeng["アプリケーションエンジニア<br/>(AI生成+人間承認)"]
            E4[単体テストケース設計<br/>AI生成]
            E5[SQL検証<br/>AI補助]
            E6[アプリ実装<br/>AIがYAMLから生成]
            E7[クラス単体テスト作成<br/>AI生成]
            E8[クラス単体テスト実施<br/>AI自動実行]
            E9[取引単体テスト実施<br/>+AI補助]
            E10[コードレビュー<br/>AI一次レビュー]
        end
        subgraph data2["データアナリスト"]
            E11[共通テストデータ作成<br/>AI生成]
        end
    end

    %% 結合テスト工程
    subgraph phase4["結合テスト工程"]
        subgraph infra2["インフラ<br/>(AI自動化+人間確認)"]
            F1[結合テスト環境構築<br/>AI自動構築]
        end
        subgraph designer2["要件定義者・設計者"]
            F2[テストケース作成<br/>AI生成]
            F3[テスト実行<br/>+AIバグ分析]
        end
    end

    %% 依存関係
    A1 --> A2
    A2 --> B1
    B1 --> B2
    B2 --> B3
    B3 --> B4
    B4 --> C1
    C1 --> C2
    C2 --> C3
    C3 --> D1
    C3 --> D2
    C3 --> D3
    C3 --> D4
    C3 --> D5
    D1 --> E3
    D2 --> E3
    D3 --> E3
    D4 --> E3
    D5 --> E3
    B4 --> E1
    E1 --> E2
    E3 --> E6
    D1 --> E4
    D2 --> E4
    D3 --> E4
    E4 --> E5
    E5 --> E6
    E6 --> E10
    E10 --> E7
    E7 --> E8
    E8 --> E9
    C4 --> E11
    E9 --> F1
    E11 --> F1
    F1 --> F2
    F2 --> F3
```

---

## ロール別協働モデル

| ロール | AsIsとの変化 | 協働モデル | 主な変化点 |
|--------|--------------|-----------|-----------|
| **要件定義者** | 変化小 | **人間主導 + AI技術実現性チェック** | AIがNablarchパターンで実現可能性を早期検証 |
| **アーキテクト** | **変化大** | **AI生成 + 人間承認** | AI が設計ドラフト・標準を生成、人間が承認（実装→レビューへ） |
| **データアナリスト** | 変化中 | **人間主導 + AI整合性チェック** | AIが整合性チェック・データ生成を補助 |
| **要件定義者／設計者** | 変化中 | **人間がYAML作成** | Excel→YAMLへ形式変更、AIがテストケース生成 |
| **アプリケーションエンジニア** | **変化大** | **AI生成 + 人間承認** | AIがYAMLから実装・テストを生成、人間が承認（実装→レビューへ） |
| **インフラ** | **変化大** | **AI自動化 + 人間確認** | 環境構築をAI自動化、人間は確認のみ（構築→監視へ） |

---

## 主要成果物（工程別）

| 工程 | IN（インプット） | OUT（アウトプット） | 形式変化 |
|------|------------------|---------------------|----------|
| **要件定義** | 業務ヒアリング結果 | 機能要件書（**YAML**）、非機能要件書（**YAML**）、業務フロー図、**技術実現性レポート（新規・AI生成）** | Excel → **YAML** |
| **設計** | 機能要件書（YAML）、非機能要件書（YAML） | 方式設計書（**YAML・AI生成**）、基盤コンポーネント設計書（**YAML・AI生成**）、開発標準（**YAML・AI生成**）、**パターン検証レポート（新規・AI生成）**、ER図、テーブル定義書（**YAML**）、システム機能設計書（**YAML**） | Excel → **YAML** |
| **PG・UT** | 方式設計書（YAML）、システム機能設計書（**YAML**）、テーブル定義書（YAML） | 業務アクション（**AI生成**）、業務フォーム（**AI生成**）、業務画面JSP（**AI生成**）、SQLファイル（**AI生成**）、単体テスト仕様書（**AI生成**）、テストコード（**AI生成**）、単体テスト結果、共通テストデータ（**AI生成**）、**コードレビューレポート（新規・AI生成）** | Java/JSP/SQL（手動）→ Java/JSP/SQL（**AI生成**） |
| **結合テスト** | システム機能設計書（YAML）、共通テストデータ | テストケース（**AI生成**）、テスト結果、**バグ分析レポート（新規・AI生成）** | Excel（手動）→ **YAML（AI生成）** |

---

## 新規アクティビティ（AsIsにはない）

- ✅ **技術実現性チェック（AI）** - 要件定義段階でNablarchパターンによる実現可能性を検証
- ✅ **パターン検証・アンチパターン検出（AI）** - 設計段階でNablarchアンチパターンをリスク検出
- ✅ **設計書のYAML化** - 全ての設計書をAI可読なYAML形式で作成・管理
- ✅ **AI生成コードのアプリケーションエンジニアレビュー** - YAMLから生成されたコードを確認・承認
- ✅ **開発標準の整合性自動チェック（AI）** - コーディング規約・UI標準・単体テスト標準間の矛盾検出

---

## 改善ポイント

- ✅ **PG・UT工程で60-70%工数削減**（アプリ実装・単体テスト作成・クラス単体テストの自動化）
- ✅ **設計書のAI可読化**（YAML形式）により実装精度向上
- ✅ **一貫したNablarchパターン適用**（AIによる自動検証・生成）
- ✅ **リアルタイムなNablarchナレッジアクセス**（nabledge知識検索）
- ✅ **設計書とコードの自動同期**（YAMLをソースとした自動生成）
- ✅ **コードレビューボトルネック解消**（AI一次レビュー → シニアエンジニア最終承認）
- ✅ **取引単体テスト（打鍵テスト）の効率化**（AIによる補助）

---

## YAML設計書の例（バッチ設計）

```yaml
batch:
  id: BATCH001
  name: プロジェクト一括登録
  type: file-to-db
  input:
    file: project_import.csv
    format: csv
    encoding: UTF-8
  processing:
    description: CSVファイルからプロジェクトをDBに登録
    validation: required
    transaction: per-record
  output:
    table: PROJECT
    operation: insert-or-update
```

**メリット**:
- YAMLはAIエージェントが正確に解釈可能
- Git管理しやすい（差分確認、バージョン管理）
- 設計書とコードの自動同期が容易
- 構造化データとして検証・変換が可能

---

**Document Owner**: Nablarch Development Team
**Last Updated**: 2026-02-16
