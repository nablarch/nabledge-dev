# 技術ライターによるエキスパートレビュー

## 全体評価

**評価**: 4/5

**総評**: 優れた技術文書群。構造が論理的で、目的が明確。日本語と英語が混在する特殊な状況に対応しており、AI エージェント向けの詳細な仕様として非常に有効。一部の一貫性の問題と、初見のユーザーにとっての学習曲線の急さが改善点。

---

## 重要な問題（High Priority）

### H1: 文書間の用語の一貫性不足

**説明**: 同じ概念に対して複数の用語が使用されており、読者の混乱を招く可能性がある。

**具体例**:
- `classification.md`: "processing-pattern" vs `improved-design-mapping.md`: "処理方式"
- `knowledge-schema.md`: "sections" vs "セクション" の混在（一貫性なし）
- "RST file" vs "rst file" vs "rstファイル" の表記揺れ

**提案**: 用語集（Glossary）を作成し、主要な概念の正式名称を定義する。各ドキュメントの冒頭で用語集への参照を追加。

**推奨アクション**: Implement Now

**理由**: 用語の一貫性は技術文書の基本要件。AI エージェントが異なる用語を同一概念として認識できない可能性がある。

---

### H2: ワークフローの依存関係が不明確

**説明**: 3つの設計書（mapping, knowledge, index）の実行順序と依存関係が明示されていない。

**現状**: 各設計書は独立して記述されているが、実際には以下の順序が必要と推測される。
1. mapping → knowledge ファイル計画の基礎
2. knowledge → index に含めるファイル情報
3. index → 検索システムの完成

**提案**: `doc/creator/` ディレクトリに `00-overview.md` を追加し、以下を記載:
- 3つのワークフローの依存関係図
- 推奨実行順序
- 各ワークフローの入出力の関係

**推奨アクション**: Implement Now

**理由**: ユーザー（AI エージェント）が誤った順序で実行すると、必要な入力ファイルが存在せずエラーになる。特に初回実行時に致命的。

---

### H3: エラー処理の指示が不十分

**説明**: スクリプトが失敗した場合の対処手順が曖昧。

**具体例**:
- `improved-design-knowledge.md` Step 4: "failした場合、エラー内容を読んでJSONを修正し、Step 3から再実行せよ"
  - どのようなエラーが想定されるか不明
  - "エラー内容を読む" が具体的にどのファイル/出力を指すか不明

**提案**: 各スクリプトのセクションに「想定されるエラーと対処法」テーブルを追加:

| エラーメッセージ | 原因 | 対処法 |
|---|---|---|
| `Schema validation failed: missing 'overview'` | JSON に overview セクションがない | sections に overview を追加 |
| `Invalid hints count: expected ≥3` | ヒント数不足 | ヒント抽出ルールを再確認し追加 |

**推奨アクション**: Implement Now

**理由**: エージェントが自律的にエラーを解決できないと、ワークフローが中断される。

---

## 中程度の問題（Medium Priority）

### M1: コード例とスキーマの不一致

**説明**: `knowledge-schema.md` の JSON 例で、スキーマ定義と実際の構造が一部不一致。

**具体例**:
- Line 446-470: `sections.overview.responsibilities` は配列として定義されているが、スキーマ定義（Line 277）では明示されていない
- Line 288: `setup` が配列と記載されているが、テンプレート説明では "list of properties" と曖昧

**提案**: JSON Schema 形式で正式なスキーマを別ファイルとして提供し、validate-knowledge.py で検証させる。

**推奨アクション**: Defer to Future

**理由**: 現状でも動作するが、長期的な保守性向上のため将来的に実装すべき。

---

### M2: 日本語と英語の混在ルールが不明確

**説明**: いつ日本語を使い、いつ英語を使うかの明確な基準がない。

**現状の観察**:
- ファイル名: 英語（classification.md）
- 見出し: 日本語（## なぜこのワークフローが重要か）
- 技術用語: 英語（Type, Category, Processing Pattern）
- 説明文: 日本語

**提案**: `CLAUDE.md` に言語使用ガイドラインを追加:
- **構造要素（ファイル名、プロパティキー）**: 英語
- **説明文**: 日本語
- **技術用語**: 英語（カタカナ表記を併記可）

**推奨アクション**: Defer to Future

**理由**: 現在のルールはユーザーの CLAUDE.md に記載されているが、具体的なドキュメント作成基準としては不十分。

---

### M3: "TOON形式" の説明不足

**説明**: `improved-design-index.md` で "TOON形式" という用語が突然登場するが、説明がない。

**Line 128**: `TOON形式。ヒントはスペース区切り。エントリはtitle順ソート。`

**提案**: TOON 形式の定義を `references/` に追加するか、初出時に詳細説明を記載:
```markdown
TOON (Terse Object Notation) 形式: 軽量なデータ記述形式。
- 構造: `key[count,]{fields}: values`
- 利点: JSON より簡潔、パース容易
```

**推奨アクション**: Defer to Future

**理由**: 初見のユーザー（エージェント）が形式を誤解釈するリスク。

---

### M4: サンプリング率の妥当性が説明されていない

**説明**: `generate-mapping-checklist.py` のサンプリング率（デフォルト 3）の根拠が不明。

**Line 360**: `--sample-rate N：サンプリング率。N行に1行をチェック対象にする（デフォルト：3）`

**提案**: サンプリング率の決定根拠を記載:
```markdown
サンプリング率: デフォルト 3（302行中約100行をチェック）
- 根拠: パスベース分類の精度86%。残り14%の検出に必要な最小サンプル数
- 必須チェック行を含めると、実効カバレッジは約95%
```

**推奨アクション**: Defer to Future

**理由**: 現状でも動作するが、ユーザーがカスタマイズする際の判断材料として有用。

---

## 低優先度の問題（Low Priority）

### L1: Markdown テーブルの読みやすさ

**説明**: 一部のテーブルが横に長く、GitHub 上で表示が崩れる可能性。

**推奨アクション**: Defer to Future

---

### L2: コマンド例のシェル表記

**説明**: コマンド例が ` ```bash ` と ` ``` ` の両方を使用（一貫性なし）。

**提案**: すべて ` ```bash ` に統一。

**推奨アクション**: Defer to Future

---

### L3: 絵文字の使用

**説明**: Official URL の表記に 🔗 絵文字を使用。

**提案**: 絵文字は環境依存の可能性があるため、代替案を検討:
- `[docs](https://...)`
- `[→](https://...)`

**推奨アクション**: Defer to Future

---

## 肯定的な側面

1. **明確な目的記述**: 各ワークフローに "なぜこのワークフローが重要か" セクションがあり、背景と価値を説明している

2. **段階的な手順**: Step 1, Step 2... の形式で手順が明確（エージェント向けに最適）

3. **入出力の明示**: 各ワークフローで入力ファイルと出力ファイルが明記されている

4. **実例の豊富さ**: JSON 例、コマンド例、出力例が充実しており、理解を助ける

5. **セッション分離の設計**: 生成と検証を別セッションに分ける設計が、バイアス軽減に有効

6. **スクリプト仕様の詳細さ**: 各スクリプトの入出力、終了コード、処理フローが詳細に記述されており、実装者に有用

7. **検証チェックリストの自動生成**: 人手を介さない検証プロセスの設計が優れている

---

## 推奨事項

### 短期（このPR内で対応）

1. **用語集の追加** (H1 対応)
2. **ワークフロー概要の追加** (H2 対応)
3. **エラー処理テーブルの追加** (H3 対応)

### 中期（次回の改善で対応）

1. **JSON Schema の正式化** (M1 対応)
2. **サンプリング率の根拠説明** (M4 対応)
3. **言語使用ガイドラインの明確化** (M2 対応)
4. **TOON形式の説明追加** (M3 対応)

### 長期（継続的な改善）

1. **ユーザーフィードバックの収集**: 実際のエージェント実行ログから改善点を抽出
2. **バージョン管理**: 設計書にバージョン番号を追加し、変更履歴を管理
3. **視覚化**: アーキテクチャ図、フローチャートの追加を検討

---

## Files Reviewed

- `.claude/skills/nabledge-creator/references/classification.md` (Reference documentation)
- `.claude/skills/nabledge-creator/references/content-judgement.md` (Reference documentation)
- `.claude/skills/nabledge-creator/references/target-path.md` (Reference documentation)
- `doc/creator/improved-design-index.md` (Design document)
- `doc/creator/improved-design-knowledge.md` (Design document)
- `doc/creator/improved-design-mapping.md` (Design document)
