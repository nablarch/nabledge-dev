# ブランチ削除ワークフロー

このワークフローは、マージ済みブランチをローカルとリモートから削除します。

## 必要なツール

- Bash
- AskUserQuestion

## 実行ステップ

### 1. 削除対象ブランチの決定

**1.1 引数の確認**

引数が指定されている場合、それを削除対象とする。
引数がない場合、次のステップでユーザーに選択させる。

**1.2 削除可能なブランチの取得**

```bash
git branch --merged main
```

結果からmainブランチを除外し、削除可能なブランチのリストを作成。

ブランチがない場合:
```
情報: 削除可能なマージ済みブランチがありません。

マージ済みブランチの一覧を確認:
git branch --merged main
```

**1.3 削除対象の選択（引数がない場合）**

AskUserQuestionでブランチを選択:

```
質問: 削除するブランチを選択してください。
header: "ブランチ削除"
options:
  - label: "{branch1}"
    description: "マージ済み"
  - label: "{branch2}"
    description: "マージ済み"
  - label: "{branch3}"
    description: "マージ済み"
```

### 2. 削除前チェック

**2.1 mainブランチの保護**

削除対象が`main`または`master`の場合はエラー終了:
```
エラー: mainブランチは削除できません。
```

**2.2 マージ済み確認**

```bash
git branch --merged main | grep "^  {branch_name}$"
```

マージされていない場合はエラー終了:
```
エラー: ブランチ「{branch_name}」はまだマージされていません。

マージされていないブランチを削除する場合は、手動で強制削除してください:
git branch -D {branch_name}

注意: 強制削除すると、マージされていない変更が失われます。
```

**2.3 カレントブランチの確認**

```bash
git branch --show-current
```

カレントブランチが削除対象の場合、mainブランチに切り替え:
```bash
git checkout main
```

### 3. mainブランチの更新

```bash
git fetch origin main
git pull origin main
```

### 4. ブランチの削除

**4.1 リモートブランチの削除**

```bash
git push origin --delete {branch_name}
```

リモートブランチが存在しない場合のエラーは無視（警告のみ表示）:
```
警告: リモートブランチ「{branch_name}」は既に削除されています。
```

権限エラーの場合:
```
エラー: リモートブランチの削除に失敗しました。
リポジトリへの書き込み権限を確認してください。

ローカルブランチのみ削除する場合:
git branch -d {branch_name}
```

**4.2 ローカルブランチの削除**

```bash
git branch -d {branch_name}
```

### 5. リモートブランチ情報の更新

```bash
git fetch --prune
```

### 6. 結果表示

```
## ブランチ削除完了

**削除したブランチ**: {branch_name}

### 実行内容
- リモートブランチ 'origin/{branch_name}' を削除しました
- ローカルブランチ '{branch_name}' を削除しました
- mainブランチに切り替えました
- 最新のコードを取得しました
```

## エラーハンドリング

| エラー | 対応 |
|--------|------|
| 削除可能なブランチがない | マージ済みブランチを確認 |
| mainブランチの削除試行 | エラーメッセージを表示して終了 |
| 未マージブランチ | 手動での強制削除を案内 |
| リモートブランチが存在しない | 警告のみ表示してローカル削除を継続 |
| 権限不足 | リポジトリの権限を確認するよう案内 |

## 注意事項

1. **絵文字の使用**: ユーザーが明示的に要求しない限り、絵文字を使わない
2. **安全性優先**: マージ済みブランチのみ削除、未マージは強制削除を案内
3. **mainブランチの保護**: mainブランチは削除を拒否
4. **リモート優先**: リモートブランチを先に削除してから、ローカルブランチを削除
