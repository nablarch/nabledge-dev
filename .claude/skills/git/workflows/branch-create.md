# 作業ブランチ作成ワークフロー

このワークフローは、mainブランチから作業ブランチを作成します。

## 必要なツール

- Bash
- AskUserQuestion

## 実行ステップ

### 1. 事前確認

**1.1 カレントブランチの確認**

```bash
git branch --show-current
```

カレントブランチが`main`でない場合はエラー終了:
```
エラー: 作業ブランチはmainブランチから作成してください。
現在のブランチ: {current_branch}

mainブランチに切り替えるには:
git checkout main
```

**1.2 ワーキングツリーの確認**

```bash
git status --porcelain
```

未コミットの変更がある場合はエラー終了:
```
エラー: 未コミットの変更があります。
変更をコミットまたはstashしてから実行してください。

変更を確認:
git status

変更をstash:
git stash
```

**1.3 リモートの最新化**

```bash
git fetch origin main
git pull origin main
```

pullが失敗（conflict）した場合:
```
エラー: mainブランチの更新に失敗しました。
コンフリクトを解決してから実行してください。
```

### 2. ブランチ名の提案

**2.1 作業目的のヒアリング**

AskUserQuestionで作業目的をヒアリング:

```
質問: このブランチで何を実装・修正しますか？
header: "作業内容"
options:
  - label: "新機能の追加"
    description: "新しい機能を実装する"
  - label: "バグ修正"
    description: "既存のバグを修正する"
  - label: "リファクタリング"
    description: "コードの構造を改善する"
  - label: "ドキュメント更新"
    description: "ドキュメントを更新する"
```

**2.2 詳細のヒアリング**

選択された作業内容に応じて、詳細をヒアリング（自由入力）:
```
「{作業内容}」の詳細を教えてください。
例: ユーザー認証機能、ログイン画面のバグ、API層のリファクタリング等
```

**2.3 ブランチ名の生成**

ヒアリングした内容から、3つのブランチ名候補を生成:

**生成ルール**:
- プレフィックス: `add-`（新機能）, `fix-`（バグ修正）, `refactor-`（リファクタリング）, `docs-`（ドキュメント）
- 本体: 詳細から抽出したキーワードを`-`で連結
- 全て小文字、英数字とハイフンのみ

**例**:
- 詳細: "ユーザー認証機能を追加"
  - 候補1: `add-user-auth`
  - 候補2: `add-authentication`
  - 候補3: `user-auth-feature`

- 詳細: "ログイン画面のバグ修正"
  - 候補1: `fix-login-page`
  - 候補2: `fix-login-bug`
  - 候補3: `login-page-fix`

**2.4 ブランチ名の選択**

AskUserQuestionで候補から選択:

```
質問: ブランチ名を選択してください。
header: "ブランチ名"
options:
  - label: "{候補1}"
    description: "推奨"
  - label: "{候補2}"
    description: ""
  - label: "{候補3}"
    description: ""
```

ユーザーが"Other"を選択した場合、自由入力を受け付ける。

**2.5 ブランチ名の重複確認**

```bash
git branch --list "{branch_name}"
```

既に存在する場合はエラー終了:
```
エラー: ブランチ「{branch_name}」は既に存在します。

別のブランチ名を使用するか、既存ブランチを削除してください:
git branch -d {branch_name}
```

### 3. ブランチ作成

選択されたブランチ名でブランチを作成:

```bash
git checkout -b {branch_name}
```

### 4. 結果表示

```
## 作業ブランチ作成完了

**ブランチ名**: {branch_name}
**ベースブランチ**: main

作業を開始できます。
変更をコミットする際は `/git commit` を使用してください。
```

## エラーハンドリング

| エラー | 対応 |
|--------|------|
| main以外のブランチから実行 | mainブランチに切り替えるよう案内 |
| 未コミットの変更がある | コミットまたはstashするよう案内 |
| mainの更新に失敗 | コンフリクトを解決するよう案内 |
| ブランチ名が既に存在 | 別の名前を使用するか、既存ブランチを削除するよう案内 |

## 注意事項

1. **絵文字の使用**: ユーザーが明示的に要求しない限り、絵文字を使わない
2. **ブランチ名の品質**: ユーザーの入力から適切なブランチ名を生成する
3. **安全性**: mainブランチの保護、重複チェック、作業ツリーのクリーン確認
