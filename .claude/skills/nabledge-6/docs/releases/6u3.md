# リリースノート 6u3

Nablarch 6u3のリリースノート。6u2からの変更点を記載

**主な変更点**:
- OpenAPI対応に伴うRESTful Webサービスの機能強化（親クラス・インタフェースでのリソース定義対応）
- EntityResponseに型パラメータ追加
- マルチパートリクエスト用のBodyConverter追加
- BeanUtilのDate and Time APIサポート拡充（OffsetDateTime追加）
- JSON読み取り不具合の修正（JSON区切り文字のみの値の解析）

**公式ドキュメント**:
- [リリースノート 6u3](https://nablarch.github.io/docs/6u3/doc/releases/nablarch6u3-releasenote.xlsx)

---

| No | カテゴリ | 種別 | タイトル | 影響 |
|----|----------|------|----------|------|
| 1 | RESTfulウェブサービス | 変更 | 親クラス・インタフェースでのリソース定義に対応
(No.24.OpenAPI対応に伴う変更) | なし |
| 2 | RESTfulウェブサービス | 変更 | EntityResponseの型パラメータ追加
(No.24.OpenAPI対応に伴う変更) | あり(開発) |
| 3 | BeanUtil | 変更 | Date and Time APIサポート拡充
(No.24.OpenAPI対応に伴う変更) | なし |
| 4 | RESTfulウェブサービス | 変更 | マルチパート用のBodyConverter追加
(No.24.OpenAPI対応に伴う変更) | なし |
| 5 | BeanUtil | 変更 | MapからBeanへ移送するメソッドのパフォーマンス改善 | なし |
| 6 | 汎用データフォーマット | 不具合 | JSONの読み取りに失敗する問題を修正 | あり(本番) |
| 7 | Bean Validation | 変更 | BeanValidationStrategyのバリデーション処理をカスタマイズできるように修正 | なし |
| 8 | 公開API | 変更 | 公開APIの追加 | なし |
| 9 | Nablarchバッチアプリケーション | 変更 | ResumeDataReaderのJavadoc改善 | なし |
| 10 | サロゲートキーの採番 | 変更 | TableIdGeneratorのJavadoc改善 | なし |
| 11 | 汎用ユーティリティ | 変更 | Base64UtilのJavadoc・解説書改善 | なし |
| 12 | 公開API | 変更 | PublishedアノテーションのJavadoc改善 | なし |
| 13 | コンポーネントの初期化 | 変更 | 初期化が必要なコンポーネントに対する説明の改善 | なし |
| 14 | RESTfulウェブサービス | 変更 | マルチパートリクエストのサポート | なし |
| 15 | ウェブアプリケーション
RESTfulウェブサービス | 変更 | Tomcatベースイメージの更新 | なし |
| 16 | 全般 | 変更 | gsp-dba-maven-pluginのバージョン更新 | なし |
| 17 | 全般 | 変更 | 使用不許可APIツールのバージョン更新 | なし |
| 18 | Jakarta RESTful Web Servicesアダプタ | 変更 | Date and Time APIのサポート
(No.24.OpenAPI対応に伴う変更) | なし |
| 19 | Jakarta RESTful Web Servicesアダプタ | 変更 | マルチパートリクエストのサポート
(No.24.OpenAPI対応に伴う変更) | あり |
| 20 | ウェブアプリケーション (JSP) | 変更 | jQuery、Bootstrapのバージョンアップ | なし |
| 21 | RESTfulウェブサービス | 変更 | マルチパートリクエストのサポート
(No.24.OpenAPI対応に伴う変更) | なし |
| 22 | 全般 | 変更 | gsp-dba-maven-pluginのバージョン更新 | なし |
| 23 | 検索結果の一覧表示 | 変更 | タグファイルのスタイル適用設定修正 | なし |
| 24 | Nablarch OpenAPI Generator | 追加 | Nablarch OpenAPI Generatorのリリース | なし |
| 25 | SQL Executor | 変更 | 解説書の手順と実際のモジュールの構成差異を修正 | なし |
| 26 | 使用不許可APIチェックツール | 不具合 | Java21でjava.lang.Objectのメソッドが許可できない場合がある問題に対応 | なし |

### 1. 親クラス・インタフェースでのリソース定義に対応
(No.24.OpenAPI対応に伴う変更)

OpenAPIドキュメントから生成したインタフェースを使用してアクションクラスを実装できるように、インターフェースや親クラスでのリソース定義を引き継ぐように対応しました。

@PathなどのJakarta RESTful Web Servicesのアノテーションを使ってアクションクラスを実装している場合に、以下の条件でアクションクラスが実装しているインターフェースや親クラスのリソース定義を引き継ぎます。
　・アクションクラスが親クラスを継承またはインターフェースを実装している
　・親クラスまたはインターフェースに@Pathアノテーションが注釈されている
　・親クラスまたはインターフェースにHTTPメソッドが定義されている

また、本対応にはルーティングアダプタも修正する必要があったため、合わせて対応しました。

**モジュール**: nablarch-fw-jaxrs 2.2.0
nablarch-router-adaptor 2.2.0

**JIRA**: NAB-618

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/web_service/rest/feature_details/resource_signature.html

---

### 2. EntityResponseの型パラメータ追加
(No.24.OpenAPI対応に伴う変更)

OpenAPIドキュメントとのマッピングに対応するため、EntityResponseに型パラメータを追加しました。
これにより、どのようなエンティティの型をレスポンスとしているかをより明確に表現できるようになりました。

**モジュール**: nablarch-fw-jaxrs 2.2.0

**影響詳細**: すでにEntityResponseを使用している個所については型を指定していない状態になるため、コンパイル時に以下のメッセージが出力されるようになります。また、設定によってはIDEで同様の警告が出力されるようになります。

[INFO] (該当クラス)の操作は、未チェックまたは安全ではありません。

解消しなくても動作に影響はありませんが、EntityResponseを使用している個所で明示的に型を指定すると、メッセージおよび警告は解消されます。


**JIRA**: NAB-619

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/web_service/rest/feature_details/resource_signature.html

---

### 3. Date and Time APIサポート拡充
(No.24.OpenAPI対応に伴う変更)

OpenAPIドキュメントとのマッピングに対応するため、Date and Time APIのサポートを拡充し、OffsetDateTimeのサポートを追加しました。


**モジュール**: nablarch-core-beans 2.3.0

**JIRA**: NAB-620

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/libraries/bean_util.html

---

### 4. マルチパート用のBodyConverter追加
(No.24.OpenAPI対応に伴う変更)

OpenAPIドキュメントとのマッピングに対応するため、Content-Typeがmultipart/form-dataのリクエストに対応するBodyConverterを追加しました。


**モジュール**: nablarch-fw-jaxrs 2.2.0

**JIRA**: NAB-621

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/web_service/rest/feature_details/resource_signature.html

---

### 5. MapからBeanへ移送するメソッドのパフォーマンス改善

MapからBeanへ移送する際、ネストしたオブジェクト数が多い場合に処理が遅くなる事象が発生していたので、修正しました。


**モジュール**: nablarch-core-beans 2.3.0

**JIRA**: NAB-634

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/libraries/bean_util.html

---

### 6. JSONの読み取りに失敗する問題を修正

JSON内に含まれる値（""で囲われた項目）がJSON構文で意味を持つ区切り文字（:、[、{、, の4つ）のみで、かつその後にデータが続く場合、値とJSON構文の区切り文字の区別ができずに失敗していました。

①NGになる例（":"の後にデータが続く）：
  {"key1": ":", "key2": "value2"}

②OKになる例（":"の後にデータが続かない）：
  {"key1": ":"}

NGになっていた例も、正常に値として解析できるように修正しました。


**モジュール**: nablarch-core-dataformat 2.0.3

**影響バージョン**: 1.3.1

**影響詳細**: 概要の①のようにJSONの区切り文字のみが値になるデータを解析できるようになります。
本来は値として解析できることが正しい挙動であるため影響が無い想定ですが、もしこのようなJSONを読み込めるようになることでシステム影響がある場合、値の確認をして受け入れないようにするなどの修正を行ってください。

**JIRA**: NAB-639

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/libraries/data_io/data_format.html

---

### 7. BeanValidationStrategyのバリデーション処理をカスタマイズできるように修正

BeanValidationStrategyをカスタマイズしやすくなるよう、公開APIを見直しました。
それに伴い、バリデーションエラーのメッセージをソートするsortMessagesメソッドをオーバーライド可能にするため、static修飾子を除去しました。


**モジュール**: nablarch-fw-web 2.3.0

**JIRA**: NAB-640

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/libraries/validation/bean_validation.html

---

### 8. 公開APIの追加

解説書で継承を案内しているAPIの中で公開APIになっていないものがあったため、公開APIを追加しました。


**モジュール**: nablarch-common-dao 2.3.0
nablarch-common-databind 2.1.0

**JIRA**: NAB-641

---

### 9. ResumeDataReaderのJavadoc改善

ResumeDataReaderが内部的に使用するResumePointManagerは初期化が必要ですが、
この点をResumeDataReaderに関する説明から読み取りづらかったため、ResumeDataReaderのJavadocに追記しました。


**モジュール**: nablarch-fw-batch 2.0.1

**JIRA**: NAB-629

**参照**: https://nablarch.github.io/docs/6u3/javadoc/nablarch/fw/reader/ResumeDataReader.html

---

### 10. TableIdGeneratorのJavadoc改善

採番の際に独立したトランザクションを用いるFastTableIdGeneratorは初期化が必要ですが、Javadoc上でそれがわからなかったため、その旨を追記しました。
また類似のコンポーネントであるTableIdGeneratorのJavadocにも、記述を合わせるため同様の更新を行っています。


**モジュール**: nablarch-common-idgenerator-jdbc 2.0.1

**JIRA**: NAB-629

**参照**: https://nablarch.github.io/docs/6u3/javadoc/nablarch/common/idgenerator/FastTableIdGenerator.html


---

### 11. Base64UtilのJavadoc・解説書改善

Base64UtilはRFC4648の「4. Base 64 Encoding」に準拠していますが、Javadoc上で明記できていなかったため、その旨を追記しました。

また、Java8以降ではBase64エンコーディングを行う標準APIが提供されており、Base64Utilを使用せずとも同様の処理を行えます。
Base64Utilを使用する必要性が小さくなったため、Javadocで標準APIを案内し、Base64Utilは後方互換性のための位置付けとしました。
そのため、Base64Utilは後方互換のために存在していることを解説書に追記しました。
※現在Base64Utilを使用している個所を標準APIに置換する必要はありません。


**モジュール**: nablarch-core-2.2.1

**JIRA**: NAB-626

**参照**: https://nablarch.github.io/docs/6u3/javadoc/nablarch/core/util/Base64Util.html

---

### 12. PublishedアノテーションのJavadoc改善

PublishedアノテーションのJavadocで、オーバーライド可能なメソッドは公開APIとしていることについて追記しました。

**モジュール**: nablarch-core-2.2.1

**JIRA**: NAB-640

**参照**: https://nablarch.github.io/docs/6u3/javadoc/nablarch/core/util/annotation/Published.html

---

### 13. 初期化が必要なコンポーネントに対する説明の改善

コンポーネントとして使用することを想定して提供しているクラスのうち、初期化が必要であるにも関わらず解説書への記載がないものがあったので、初期化が必要な旨や設定例を追記しました。

・Nablarchが提供するライブラリ
　・コード管理
　・サロゲートキーの採番
　・日付管理
　・メール送信
　・サービス提供可否チェック
・Nablarchの提供する標準ハンドラ
　・プロセス停止制御ハンドラ
・アダプタ
　・IBM MQアダプタ


**モジュール**: nablarch-document 6u3

**JIRA**: NAB-629

---

### 14. マルチパートリクエストのサポート

No.4およびNo.19で対応したマルチパートリクエストのサポートを取り込み、マルチパートリクエストに対応しました。


**モジュール**: nablarch-single-module-archetype 6u3

**JIRA**: NAB-621

---

### 15. Tomcatベースイメージの更新

10.1.33以前のApache Tomcatに脆弱性が検出されたため、ブランクプロジェクトのデフォルトのTomcatのベースイメージを以下に更新しました。

　tomcat:10.1.34-jdk17-temurin


**モジュール**: nablarch-single-module-archetype 6u3

**JIRA**: NAB-627

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/blank_project/setup_containerBlankProject/setup_ContainerWeb.html

---

### 16. gsp-dba-maven-pluginのバージョン更新

以下のMavenプラグインを記載のバージョンに更新しました。
・gsp-dba-maven-plugin：5.2.0


**モジュール**: nablarch-single-module-archetype 6u3

**JIRA**: NAB-636

---

### 17. 使用不許可APIツールのバージョン更新

No.26の対応に伴い、使用不許可APIツールのバージョンを以下に更新しました。
・nablarch-unpublished-api-checker 1.0.1


**モジュール**: nablarch-single-module-archetype 6u3

**JIRA**: NAB-630

---

### 18. Date and Time APIのサポート
(No.24.OpenAPI対応に伴う変更)

OpenAPIドキュメントとのマッピングに対応するため、Jackson Java 8 Date/timeモジュールを追加してDate and Time APIを扱えるようになりました。

※JaxRsHandlerListFactory を独自に実装している場合、バージョンアップだけでは本機能は使用できません。本機能を使用したい場合は、nablarch-jersey-adaptorおよびnablarch-resteasy-adaptorの実装を参考にしてください。


**モジュール**: nablarch-jaxrs-adaptor 2.2.0
nablarch-jersey-adaptor 2.2.0
nablarch-resteasy-adaptor 2.2.0
nablarch-jackson-adaptor 2.2.0

**JIRA**: NAB-620

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/adaptors/jaxrs_adaptor.html

---

### 19. マルチパートリクエストのサポート
(No.24.OpenAPI対応に伴う変更)

No.4で追加したマルチパート用のBodyConverterをnablarch-jersey-adaptorおよびnablarch-resteasy-adaptorに追加しました。




**モジュール**: nablarch-jaxrs-adaptor 2.2.0
nablarch-jersey-adaptor 2.2.0
nablarch-resteasy-adaptor 2.2.0
nablarch-jackson-adaptor 2.2.0

**影響詳細**: 6u2以前からのバージョンアップで本機能を使用する場合は、設定変更が必要になります。詳しくは「マルチパートリクエストのサポート対応」シートを参照してください。

**JIRA**: NAB-621

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/adaptors/jaxrs_adaptor.html

---

### 20. jQuery、Bootstrapのバージョンアップ

jQueryおよびjQeuryに依存していたライブラリのバージョンを以下の通り更新しました。
・jQuery 3.7.1
・jQuery UI 1.14
・Bootstrap 5.3.3
また、Bootstrapのバージョンアップに伴ってMaterial Design for Bootstrapの使用を廃止し、画面デザインを調整しました。


**モジュール**: nablarch-example-web 6u3

**影響バージョン**: -

**JIRA**: NAB-616

**参照**: https://nablarch.github.io/docs/6u3/doc/application_framework/application_framework/web/index.html

---

### 21. マルチパートリクエストのサポート
(No.24.OpenAPI対応に伴う変更)

No.4およびNo.19で対応したnablarch-fw-jaxrsおよびnablarch-jaxrs-adaptorの変更内容を取り込み、マルチパートリクエストに対応しました。


**モジュール**: nablarch-example-rest 6u3

**JIRA**: NAB-621

---

### 22. gsp-dba-maven-pluginのバージョン更新

以下のMavenプラグインを記載のバージョンに更新しました。
・gsp-dba-maven-plugin：5.2.0


**モジュール**: nablarch-example-web  6u3
nablarch-example-thymeleaf-web  6u3
nablarch-example-rest  6u3
nablarch-example-batch  6u3
nablarch-example-batch-ee  6u3
nablarch-example-http-messaging  6u3
nablarch-example-http-messaging-send  6u3
nablarch-example-db-queue  6u3
nablarch-example-mom-delayed-receive  6u3
nablarch-example-mom-delayed-send  6u3
nablarch-example-mom-sync-receive  6u3
nablarch-example-mom-sync-send-batch  6u3

**JIRA**: NAB-636

---

### 23. タグファイルのスタイル適用設定修正

ページングの現在表示中のページ番号部分に対して、カスタムタグで指定したスタイルが適用されていなかったため、表示中かどうかに関わらず設定したCSSが適用されるように修正しました。


**モジュール**: nablarch-biz-sample-all 3.1.0

**影響バージョン**: -

**JIRA**: NAB-616

**参照**: https://nablarch.github.io/docs/6u3/doc/biz_samples/03/index.html

---

### 24. Nablarch OpenAPI Generatorのリリース

OpenAPIドキュメントからアプリケーションのコード生成をサポートするツールである Nablarch OpenAPI Generator をリリースしました。


**モジュール**: nablarch-openapi-generator 1.0.0

**影響バージョン**: -

**JIRA**: NAB-624

**参照**: https://nablarch.github.io/docs/6u3/doc/development_tools/toolbox/NablarchOpenApiGenerator/NablarchOpenApiGenerator.html

---

### 25. 解説書の手順と実際のモジュールの構成差異を修正

ツールの提供状態として設定すべき項目に不足があり、また解説書で案内している設定ファイル名と実際のファイル名に乖離がありました。
このため解説書どおりに実行しても起動できないという問題が発生しており、解説書記載の手順で実行できるように設定ファイルの見直しを行いました。


**モジュール**: sql-executor 1.3.1

**影響バージョン**: -

**JIRA**: NAB-637

**参照**: https://nablarch.github.io/docs/6u3/doc/development_tools/toolbox/SqlExecutor/SqlExecutor.html

---

### 26. Java21でjava.lang.Objectのメソッドが許可できない場合がある問題に対応

Java21でバイトコードが変わったことにより、インタフェースからjava.lang.Objectのメソッドを呼んでいる場合、設定ファイルで指定しても許可されないという不具合があったため対応しました。

例) 
■使用不許可APIツールの設定ファイル
java.lang.Object

■解析対象のjavaファイル
// toStringメソッドは本来許可されるはずだが不許可になる
Map<String, String> headers = request.headers();
headers.toString();


**モジュール**: nablarch-unpublished-api-checker 1.0.1

**影響バージョン**: 1.0.0

**JIRA**: NAB-630

**参照**: https://nablarch.github.io/docs/LATEST/doc/development_tools/java_static_analysis/index.html#id6

---
