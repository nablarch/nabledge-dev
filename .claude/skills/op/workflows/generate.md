# 朝会用メッセージ生成ワークフロー

このワークフローは朝会用のメッセージを自動生成します。

## 必要なツール

- Bash
- AskUserQuestion

## 実行ステップ

### 1. 今日クローズしたIssueを取得

**1.1 今日の日付を取得**

```bash
today=$(date -I)
echo "今日の日付: $today"
```

**1.2 GitHubリポジトリの確認**

```bash
gh repo view --json nameWithOwner -q .nameWithOwner
```

リポジトリ情報が取得できない場合:
```
エラー: GitHubリポジトリが見つかりません。

確認事項:
1. 現在のディレクトリがGitリポジトリか確認してください
2. gh CLIが認証されているか確認してください (gh auth login)
```

**1.3 今日クローズしたIssueを取得**

```bash
gh issue list \
  --state closed \
  --search "closed:>=$today" \
  --json number,title,closedAt,url \
  --limit 100
```

**1.4 結果の解析**

- 結果が空配列 `[]` の場合: Issueリストを「今日クローズしたIssueはありません」として処理
- 結果がある場合: Issue情報を保存して次のステップへ

### 2. ユーザーからのヒアリング

**2.1 発見のヒアリング**

AskUserQuestion toolを使用:

```
Question: "今日の発見は何ですか？(技術的な気づき、学び、改善点など)"
Options:
  - "Other: {自由記述}"
multiSelect: false
```

ユーザーの回答を `discoveries` として保存。

**2.2 その他のヒアリング**

AskUserQuestion toolを使用:

```
Question: "その他共有したいことはありますか？(予定、相談事項など。なければ「なし」と入力してください)"
Options:
  - "Other: {自由記述}"
multiSelect: false
```

ユーザーの回答を `other_notes` として保存。
回答が空または「なし」の場合は `other_notes = "なし"` とする。

### 3. 振り返りの生成

**3.1 成果の分析**

今日クローズしたIssueのタイトルと内容から以下を分析:
- 主要な成果は何か
- どのような問題を解決したか
- どのような機能を追加したか
- 今後への影響は何か

**3.2 振り返り文の生成**

以下の基準で振り返りを生成:
- **長さ**: 200文字程度 (180-220文字が目安)
- **構成**: 3つのパートで構成
  1. 今日の成果 (何を達成したか)
  2. その意義 (なぜ重要か、誰に役立つか)
  3. 今後への影響 (次に何ができるか)
- **トーン**: 前向きで建設的、具体的な表現
- **言語**: 日本語

**生成アプローチ**:
1. Issueタイトルから主要なテーマを抽出
2. 複数Issueがあれば共通テーマや関連性を見つける
3. 第1文: 今日の具体的な成果を述べる
4. 第2-3文: その成果の意義と誰に・どう役立つかを説明
5. 第4文: 今後の展開や影響を述べる

**生成例**:
```
今日はユーザー認証機能の実装を完了し、セキュリティレビューも通過しました。
これによりユーザーが安全にログインできる基盤が整い、次フェーズの権限管理機能の
開発に着手できます。また、認証フローのテスト自動化により品質保証も強化されました。
```

### 4. Teamsメッセージの出力

**4.1 メッセージフォーマット**

以下の形式で出力:

```
## アウトプット

{Issueリスト}

## 発見

{ユーザーからの入力}

## 振り返り

{自動生成された振り返り (200文字程度)}

## その他

{ユーザーからの入力、なければ「なし」}
```

**4.2 Issueリストのフォーマット**

Issueが存在する場合:
```
- #{number}: {title} ({url})
- #{number}: {title} ({url})
...
```

Issueが0件の場合:
```
今日クローズしたIssueはありません
```

**4.3 完全な出力例**

```
## アウトプット

- #68: 開発者として、1日の終わりに翌朝の朝会用メッセージを自動生成したい。なぜなら効率的に進捗を共有するため (https://github.com/owner/repo/issues/68)
- #67: バグ修正: ログイン時のセッションタイムアウト問題 (https://github.com/owner/repo/issues/67)

## 発見

Task toolの使い方について理解が深まりました。特にサブエージェントを使った
ワークフロー分離のパターンが効果的だと感じました。

## 振り返り

今日は朝会用メッセージ生成スキルの実装を完了しました。これにより毎日の
振り返り作成が自動化され、開発者は本来の開発作業に集中できるようになります。
また、GitHub APIを活用した自動情報収集のパターンを確立できたことで、今後の
類似機能開発にも応用できる見込みです。

## その他

明日は新しいスキルのテストを実施する予定です。
```

## エラーハンドリング

| エラー | 対応 |
|-------|------|
| gh CLIが利用できない | `gh auth login` の実行を案内 |
| GitHubリポジトリではない | 現在のディレクトリの確認を案内 |
| Issueの取得に失敗 | エラーメッセージを表示して処理を中断 |
| ユーザー入力が空 | 「なし」として処理を続行 |

## 重要な注意事項

1. **日本語出力**: すべてのメッセージとフォーマットは日本語で出力
2. **Issue数**: 100件を上限として取得 (通常は十分)
3. **日付形式**: ISO 8601形式 (YYYY-MM-DD) を使用
4. **振り返りの品質**: 単なる事実の羅列ではなく、意義や影響を含める
5. **コピー可能**: 出力はそのままTeamsに貼り付けできる形式

## 実装のポイント

### Issue取得のフィルタリング

`gh issue list` コマンドの `--search` オプションで `closed:>=` を使用することで、
今日以降にクローズされたIssueを効率的に取得できます。

### 振り返り生成のロジック

1. Issueのタイトルから主要なテーマを抽出
2. 複数のIssueがある場合は共通のテーマや関連性を見つける
3. 成果の意義を考察 (なぜ重要か、誰に役立つか)
4. 今後への影響を考察 (次に何ができるか、何が変わるか)
5. 200文字程度にまとめる

### ユーザー体験の最適化

- 質問は明確かつ簡潔に
- デフォルト値を提供 (「なし」など)
- エラーメッセージは具体的な対処方法を含める
- 出力はコピーしやすい形式にする
